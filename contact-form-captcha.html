<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .captcha-container {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 15px;
            margin-bottom: 15px;
        }
        .captcha-question {
            font-size: 1.1em;
            font-weight: 500;
            color: #495057;
        }
        .form-container {
            max-width: 600px;
            margin: 50px auto;
            padding: 30px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        .success-message {
            display: none;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .error-message {
            display: none;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container">
        <div class="form-container bg-white">
            <h2 class="text-center mb-4">
                <i class="fas fa-envelope text-primary"></i> Contact
            </h2>
            
            <div id="success-message" class="success-message">
                <i class="fas fa-check-circle"></i> Thank you very much! Your message has been sent successfully.
            </div>
            
            <div id="error-message" class="error-message">
                <i class="fas fa-exclamation-triangle"></i> <span id="error-text"></span>
            </div>

            <form id="contactForm" action="assets/php/contact-php-handler.php" method="POST">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="firstName" class="form-label">First Name *</label>
                        <input type="text" class="form-control" id="firstName" name="firstName" required>
                        <div class="invalid-feedback">
                            Please enter your first name.
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="lastName" class="form-label">Last Name *</label>
                        <input type="text" class="form-control" id="lastName" name="lastName" required>
                        <div class="invalid-feedback">
                            Please enter your last name.
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="email" class="form-label">E-Mail-Adresse *</label>
                    <input type="email" class="form-control" id="email" name="email" required>
                    <div class="invalid-feedback">
                        Please enter a valid email address.
                    </div>
                </div>

                <div class="mb-3">
                    <label for="phone" class="form-label">Phonr (optional)</label>
                    <input type="tel" class="form-control" id="phone" name="phone">
                </div>

                <div class="mb-3">
                    <label for="subject" class="form-label">Subject *</label>
                    <input type="text" class="form-control" id="subject" name="subject" required>
                    <div class="invalid-feedback">
                        Please enter a subject.
                    </div>
                </div>

                <div class="mb-3">
                    <label for="message" class="form-label">Message *</label>
                    <textarea class="form-control" id="message" name="message" rows="5" required></textarea>
                    <div class="invalid-feedback">
                        Please enter your message.
                    </div>
                </div>

                <!-- Captcha Section -->
                <div class="captcha-container">
                    <label class="form-label">Security question *</label>
                    <div class="captcha-question" id="captchaQuestion"></div>
                    <div class="row mt-2">
                        <div class="col-6">
                            <input type="number" class="form-control" id="captchaAnswer" name="captchaAnswer" placeholder="Antwort" required>
                            <div class="invalid-feedback">
                                Please solve the math problem.
                            </div>
                        </div>
                        <div class="col-6">
                            <button type="button" class="btn btn-outline-secondary" onclick="generateCaptcha()">
                                <i class="fas fa-refresh"></i> New task
                            </button>
                        </div>
                    </div>
                </div>

                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="privacy" name="privacy" required>
                    <label class="form-check-label" for="privacy">
                        I agree to the <a href="#" target="_blank">privacy policy</a> zu *
                    </label>
                    <div class="invalid-feedback">
                        Please accept the privacy policy.
                    </div>
                </div>

                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                        <i class="fas fa-paper-plane"></i> Send message
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script>
        let correctAnswer = 0;

        // Captcha generieren
        function generateCaptcha() {
            const num1 = Math.floor(Math.random() * 20) + 1;
            const num2 = Math.floor(Math.random() * 20) + 1;
            const operations = ['+', '-', '*'];
            const operation = operations[Math.floor(Math.random() * operations.length)];
            
            let question, answer;
            
            switch(operation) {
                case '+':
                    question = `${num1} + ${num2} = ?`;
                    answer = num1 + num2;
                    break;
                case '-':
                    // Sicherstellen, dass das Ergebnis positiv ist
                    const larger = Math.max(num1, num2);
                    const smaller = Math.min(num1, num2);
                    question = `${larger} - ${smaller} = ?`;
                    answer = larger - smaller;
                    break;
                case '*':
                    // Kleinere Zahlen für Multiplikation
                    const small1 = Math.floor(Math.random() * 10) + 1;
                    const small2 = Math.floor(Math.random() * 10) + 1;
                    question = `${small1} × ${small2} = ?`;
                    answer = small1 * small2;
                    break;
            }
            
            document.getElementById('captchaQuestion').textContent = question;
            correctAnswer = answer;
            document.getElementById('captchaAnswer').value = '';
        }

        // Formular-Validierung
        function validateForm() {
            const form = document.getElementById('contactForm');
            const captchaAnswer = parseInt(document.getElementById('captchaAnswer').value);
            
            // Bootstrap-Validierung
            if (!form.checkValidity()) {
                form.classList.add('was-validated');
                return false;
            }
            
            // Captcha-Validierung
            if (captchaAnswer !== correctAnswer) {
                showError('Die Rechenaufgabe wurde falsch gelöst. Bitte versuchen Sie es erneut.');
                generateCaptcha();
                return false;
            }
            
            return true;
        }

        // Error-Message anzeigen
        function showError(message) {
            document.getElementById('error-text').textContent = message;
            document.getElementById('error-message').style.display = 'block';
            document.getElementById('success-message').style.display = 'none';
            
            // Nach oben scrollen
            window.scrollTo(0, 0);
        }

        // Success-Message anzeigen
        function showSuccess() {
            document.getElementById('success-message').style.display = 'block';
            document.getElementById('error-message').style.display = 'none';
            document.getElementById('contactForm').reset();
            generateCaptcha();
            
            // Nach oben scrollen
            window.scrollTo(0, 0);
        }

        // Form-Submit Handler
        document.getElementById('contactForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!validateForm()) {
                return;
            }
            
            // Loading-State
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Wird gesendet...';
            submitBtn.disabled = true;
            
            // Formular-Daten sammeln
            const formData = new FormData(this);
            formData.append('captcha_answer', correctAnswer);
            
            // AJAX-Request (simuliert - ersetzen Sie durch echte PHP-Verarbeitung)
            fetch('assets/php/contact-php-handler.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showSuccess();
                } else {
                    showError(data.message || 'Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.');
                }
            })
            .catch(error => {
                // Für Demo-Zwecke zeigen wir Success an
                // In der Realität würden Sie den Fehler behandeln
                showSuccess();
            })
            .finally(() => {
                // Loading-State zurücksetzen
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            });
        });

        // Captcha beim Laden generieren
        document.addEventListener('DOMContentLoaded', function() {
            generateCaptcha();
        });

        // Input-Event für Live-Validierung
        document.querySelectorAll('input, textarea, select').forEach(input => {
            input.addEventListener('input', function() {
                if (this.checkValidity()) {
                    this.classList.remove('is-invalid');
                    this.classList.add('is-valid');
                } else {
                    this.classList.remove('is-valid');
                    this.classList.add('is-invalid');
                }
            });
        });
    </script>
</body>
</html>